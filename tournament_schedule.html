<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>健祥盃圍棋公開賽 - 賽程時間與頒獎</title>
    <style>
        body {
            font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f6;
            color: #333;
        }
        .container {
            max-width: 1400px; /* 增加最大寬度以容納更多欄位 */
            margin: 0 auto;
            background-color: #ffffff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            overflow-x: auto; /* 當內容超出寬度時，允許水平滾動 */
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 25px;
            font-size: 2.2em;
        }
        .update-info {
            text-align: center;
            margin-bottom: 20px;
            font-size: 0.9em;
            color: #7f8c8d;
        }
        .filter-section {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        .filter-section label {
            margin-right: 10px;
        }
        .filter-section select {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            background-color: white;
            cursor: pointer;
            min-width: 150px; /* 讓選單不要太窄 */
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 0.95em;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px 10px; /* 稍微縮小內邊距以容納更多欄位 */
            text-align: center;
            white-space: nowrap; /* 避免文字換行 */
        }
        th {
            background-color: #4CAF50; /* Primary green */
            color: white;
            font-weight: bold;
        }
        td {
            background-color: #fdfdfd;
        }
        tr:nth-child(even) td {
            background-color: #f9f9f9;
        }
        tr:hover td {
            background-color: #e6ffe6; /* Light green on hover */
        }
        .important-note {
            background-color: #fff3cd;
            border-left: 5px solid #ffe082;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            color: #856404;
            font-size: 0.9em;
        }
        /* Responsive adjustments for mobile */
        @media (max-width: 1024px) { /* 在這個斷點下，表格開始允許水平滾動 */
            .container {
                max-width: 100%; /* 讓容器佔滿螢幕寬度 */
            }
            table {
                width: auto; /* 讓表格內容決定其寬度，以便滾動 */
                min-width: 1000px; /* 確保表格在滾動時仍有足夠寬度 */
            }
            th, td {
                padding: 8px 6px; /* 再次縮小內邊距 */
                font-size: 0.8em; /* 縮小字體 */
            }
        }
        @media (max-width: 768px) { /* 在更小的螢幕上，表格可能需要堆疊 */
            /* 調整手機板堆疊樣式，為更多欄位設定 before content */
            table, thead, tbody, th, td, tr {
                display: block;
            }
            thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            tr { border: 1px solid #ccc; margin-bottom: 15px; }
            td {
                border: none;
                border-bottom: 1px solid #eee;
                position: relative;
                padding-left: 65%; /* 增加左側空間以容納更長的標籤 */
                text-align: right;
            }
            td:before {
                position: absolute;
                top: 6px;
                left: 6px;
                width: 60%; /* 增加標籤的寬度 */
                padding-right: 10px;
                white-space: nowrap;
                text-align: left;
                font-weight: bold;
                color: #555;
            }
            /* Labeling the data cells - 確保所有欄位都有對應的標籤 */
            td:nth-of-type(1):before { content: "組別"; }
            td:nth-of-type(2):before { content: "第一場"; }
            td:nth-of-type(3):before { content: "第二場"; }
            td:nth-of-type(4):before { content: "第三場"; }
            td:nth-of-type(5):before { content: "第四場"; }
            td:nth-of-type(6):before { content: "第五場"; }
            td:nth-of-type(7):before { content: "頒獎時間"; }
            td:nth-of-type(8):before { content: "冠軍"; }
            td:nth-of-type(9):before { content: "亞軍"; }
            td:nth-of-type(10):before { content: "季軍"; }
            td:nth-of-type(11):before { content: "殿軍"; }
            td:nth-of-type(12):before { content: "第五名"; }
            td:nth-of-type(13):before { content: "第六名"; }
            td:nth-of-type(14):before { content: "第七名"; }
            td:nth-of-type(15):before { content: "第八名"; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🏆 2025 第四屆彰化縣健祥盃全國圍棋公開賽</h1>
        <div class="update-info">
            請重新整理頁面以更新賽程：<span id="lastUpdated"></span>
        </div>
        
        <div class="filter-section">
            <label for="groupSelector">選擇組別：</label>
            <select id="groupSelector">
            </select>
        </div>

        <table id="scheduleTable">
            <thead>
                <tr>
                    <th>組別</th>
                    <th>第一場</th>
                    <th>第二場</th>
                    <th>第三場</th>
                    <th>第四場</th>
                    <th>第五場</th>
                    <th>頒獎時間</th>
                    <th>冠軍</th>
                    <th>亞軍</th>
                    <th>季軍</th>
                    <th>殿軍</th>
                    <th>第五名</th>
                    <th>第六名</th>
                    <th>第七名</th>
                    <th>第八名</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

        <div class="important-note">
            <strong>重要提示：</strong> 各場次開賽時間將依實際比賽進度動態調整，請隨時留意本頁面最新公告！頒獎時間為預估，實際頒獎時間請依現場廣播為準。名次資訊將於比賽結束後陸續更新。
        </div>
    </div>

    <script>
        // *** 預設的組別資料 - 即使讀不到 Google Sheet 也會顯示這些組別 ***
        // *** 您可以在這裡新增或刪除組別，確保所有組別都列在這裡 ***
        // *** 這些組別名稱也會用來填充下拉選單 ***

        const defaultScheduleData = [
            { group: "六段組", round1: null, round2: null, round3: null, round4: null, round5: null, award: null, champion: null, runnerUp: null, thirdPlace: null, fourthPlace: null, fifthPlace: null, sixthPlace: null, seventhPlace: null, eighthPlace: null },
            { group: "五段組", round1: null, round2: null, round3: null, round4: null, round5: null, award: null, champion: null, runnerUp: null, thirdPlace: null, fourthPlace: null, fifthPlace: null, sixthPlace: null, seventhPlace: null, eighthPlace: null },
            { group: "四段組", round1: null, round2: null, round3: null, round4: null, round5: null, award: null, champion: null, runnerUp: null, thirdPlace: null, fourthPlace: null, fifthPlace: null, sixthPlace: null, seventhPlace: null, eighthPlace: null },
            { group: "三段組", round1: null, round2: null, round3: null, round4: null, round5: null, award: null, champion: null, runnerUp: null, thirdPlace: null, fourthPlace: null, fifthPlace: null, sixthPlace: null, seventhPlace: null, eighthPlace: null },
            { group: "二段組", round1: null, round2: null, round3: null, round4: null, round5: null, award: null, champion: null, runnerUp: null, thirdPlace: null, fourthPlace: null, fifthPlace: null, sixthPlace: null, seventhPlace: null, eighthPlace: null },
            { group: "初段組", round1: null, round2: null, round3: null, round4: null, round5: null, award: null, champion: null, runnerUp: null, thirdPlace: null, fourthPlace: null, fifthPlace: null, sixthPlace: null, seventhPlace: null, eighthPlace: null },
            { group: "甲組", round1: null, round2: null, round3: null, round4: null, round5: null, award: null, champion: null, runnerUp: null, thirdPlace: null, fourthPlace: null, fifthPlace: null, sixthPlace: null, seventhPlace: null, eighthPlace: null },
            { group: "乙組", round1: null, round2: null, round3: null, round4: null, round5: null, award: null, champion: null, runnerUp: null, thirdPlace: null, fourthPlace: null, fifthPlace: null, sixthPlace: null, seventhPlace: null, eighthPlace: null },
            { group: "丙組", round1: null, round2: null, round3: null, round4: null, round5: null, award: null, champion: null, runnerUp: null, thirdPlace: null, fourthPlace: null, fifthPlace: null, sixthPlace: null, seventhPlace: null, eighthPlace: null },
            { group: "丁組", round1: null, round2: null, round3: null, round4: null, round5: null, award: null, champion: null, runnerUp: null, thirdPlace: null, fourthPlace: null, fifthPlace: null, sixthPlace: null, seventhPlace: null, eighthPlace: null },
            { group: "戊組", round1: null, round2: null, round3: null, round4: null, round5: null, award: null, champion: null, runnerUp: null, thirdPlace: null, fourthPlace: null, fifthPlace: null, sixthPlace: null, seventhPlace: null, eighthPlace: null },
            { group: "己組", round1: null, round2: null, round3: null, round4: null, round5: null, award: null, champion: null, runnerUp: null, thirdPlace: null, fourthPlace: null, fifthPlace: null, sixthPlace: null, seventhPlace: null, eighthPlace: null },
            { group: "庚組", round1: null, round2: null, round3: null, round4: null, round5: null, award: null, champion: null, runnerUp: null, thirdPlace: null, fourthPlace: null, fifthPlace: null, sixthPlace: null, seventhPlace: null, eighthPlace: null },
            { group: "辛A組", round1: null, round2: null, round3: null, round4: null, round5: null, award: null, champion: null, runnerUp: null, thirdPlace: null, fourthPlace: null, fifthPlace: null, sixthPlace: null, seventhPlace: null, eighthPlace: null },
            { group: "辛B組", round1: null, round2: null, round3: null, round4: null, round5: null, award: null, champion: null, runnerUp: null, thirdPlace: null, fourthPlace: null, fifthPlace: null, sixthPlace: null, seventhPlace: null, eighthPlace: null },
            // Removed 辛C組 as per request
            { group: "入門A組", round1: null, round2: null, round3: null, round4: null, round5: null, award: null, champion: null, runnerUp: null, thirdPlace: null, fourthPlace: null, fifthPlace: null, sixthPlace: null, seventhPlace: null, eighthPlace: null },
            { group: "入門B組", round1: null, round2: null, round3: null, round4: null, round5: null, award: null, champion: null, runnerUp: null, thirdPlace: null, fourthPlace: null, fifthPlace: null, sixthPlace: null, seventhPlace: null, eighthPlace: null }, 
            { group: "幼兒組", round1: null, round2: null, round3: null, round4: null, round5: null, award: null, champion: null, runnerUp: null, thirdPlace: null, fourthPlace: null, fifthPlace: null, sixthPlace: null, seventhPlace: null, eighthPlace: null }
        ];

        // *** 新增：自定義組別排序的順序陣列 ***
        // *** 請確保這個陣列中的組別名稱，與 defaultScheduleData 中的 group 名稱完全一致，且順序就是您期望的排序！ ***
        const customGroupOrder = [
            "六段組", "五段組", "四段組", "三段組", "二段組", "初段組",
            "甲組", "乙組", "丙組", "丁組", "戊組", "己組",
            "庚組", "辛A組", "辛B組",
            "入門A組", "入門B組", "幼兒組"
        ];
        // *** 結束新增 ***

        let fetchedScheduleData = []; // 用於儲存從 Google Apps Script 讀取到的原始數據

        // 函數：渲染表格內容
        function renderTable(dataToDisplay) {
            const tableBody = document.querySelector('#scheduleTable tbody');
            tableBody.innerHTML = ''; // 清空現有內容

            if (dataToDisplay && dataToDisplay.length > 0) {
                dataToDisplay.forEach(item => {
                    const row = tableBody.insertRow();
                    row.insertCell().textContent = item.group || ''; 
                    row.insertCell().textContent = item.round1 || '未排定'; 
                    row.insertCell().textContent = item.round2 || '未排定';
                    row.insertCell().textContent = item.round3 || '未排定';
                    row.insertCell().textContent = item.round4 || '未排定';
                    row.insertCell().textContent = item.round5 || '未排定';
                    row.insertCell().textContent = item.award || '未排定';
                    row.insertCell().textContent = item.champion || '未公布';
                    row.insertCell().textContent = item.runnerUp || '未公布';
                    row.insertCell().textContent = item.thirdPlace || '未公布';
                    row.insertCell().textContent = item.fourthPlace || '未公布';
                    row.insertCell().textContent = item.fifthPlace || '未公布';
                    row.insertCell().textContent = item.sixthPlace || '未公布';
                    row.insertCell().textContent = item.seventhPlace || '未公布';
                    row.insertCell().textContent = item.eighthPlace || '未公布';
                });
            } else {
                // 如果篩選後沒有數據（例如選了不存在的組別），顯示提示
                tableBody.innerHTML = '<tr><td colspan="15">無符合條件的組別數據。</td></tr>';
            }

            // 請重新整理頁面以更新賽程 (此為頁面加載時間，非數據更新時間)
            const now = new Date();
            const options = {
                year: 'numeric', month: 'long', day: 'numeric',
                hour: '2-digit', minute: '2-digit', second: '2-digit',
                hour12: false // 24小時制
            };
            document.getElementById('lastUpdated').textContent = now.toLocaleString('zh-TW', options);
        }

        // 函數：填充組別下拉選單
        function populateGroupDropdown() {
            const groupSelector = document.getElementById('groupSelector');
            groupSelector.innerHTML = '<option value="all">顯示所有組別</option>'; // 預設選項

            // 從 customGroupOrder 陣列中獲取組別，這樣就能按照預設順序排列
            const uniqueGroups = customGroupOrder.filter(group => {
                // 確保只加入 defaultScheduleData 中存在的組別，避免 customGroupOrder 寫錯
                return defaultScheduleData.some(item => item.group === group);
            });

            uniqueGroups.forEach(group => {
                const option = document.createElement('option');
                option.value = group;
                option.textContent = group;
                groupSelector.appendChild(option);
            });
        }
        // 函數：根據下拉選單選擇進行篩選並重新渲染表格
        function filterAndRenderTable() {
            const selectedGroup = document.getElementById('groupSelector').value;
            let dataToProcess = JSON.parse(JSON.stringify(defaultScheduleData)); // 從預設數據開始

            // 將從 Google Sheet 獲取的數據合併到預設數據中
            if (fetchedScheduleData.length > 0) {
                fetchedScheduleData.forEach(sheetItem => {
                    const groupName = sheetItem.group;
                    const defaultItem = dataToProcess.find(item => item.group === groupName);
                    if (defaultItem) {
                        // 覆蓋預設數據中的時間和名次信息
                        defaultItem.round1 = sheetItem.round1;
                        defaultItem.round2 = sheetItem.round2;
                        defaultItem.round3 = sheetItem.round3;
                        defaultItem.round4 = sheetItem.round4;
                        defaultItem.round5 = sheetItem.round5;
                        defaultItem.award = sheetItem.award;
                        defaultItem.champion = sheetItem.champion;
                        defaultItem.runnerUp = sheetItem.runnerUp;
                        defaultItem.thirdPlace = sheetItem.thirdPlace;
                        defaultItem.fourthPlace = sheetItem.fourthPlace;
                        defaultItem.fifthPlace = sheetItem.fifthPlace;
                        defaultItem.sixthPlace = sheetItem.sixthPlace;
                        defaultItem.seventhPlace = sheetItem.seventhPlace;
                        defaultItem.eighthPlace = sheetItem.eighthPlace;
                    } else {
                        // 如果 Google Sheet 中有 defaultScheduleData 沒有的組別，則新增
                        dataToProcess.push(sheetItem);
                    }
                });
            }

            let finalDataToDisplay = [];
            if (selectedGroup === 'all') {
                finalDataToDisplay = dataToProcess; // 顯示所有組別
            } else {
                // 篩選出選中的組別
                finalDataToDisplay = dataToProcess.filter(item => item.group === selectedGroup);
            }
            
            renderTable(finalDataToDisplay); // 渲染篩選後的數據
        }

        // 從外部 Google Apps Script 載入數據
        // *** 您必須將下面的 URL 替換為您從 Google Apps Script 部署獲得的「網路應用程式網址」 ***
        // *** 範例網址看起來會像這樣：https://script.google.com/macros/s/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/exec ***
        const GOOGLE_APPS_SCRIPT_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbw3N3bJyY7OH5sg3N89LDZNMEYAgRQmZymio_X3ruhR8Dnw6pM1crGa1fEw1s0qFSdWJg/exec'; 
        
        fetch(GOOGLE_APPS_SCRIPT_WEB_APP_URL) 
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                fetchedScheduleData = data; // 儲存原始數據
                filterAndRenderTable(); // 第一次載入時，直接篩選並渲染（預設顯示所有）
            })
            .catch(error => {
                console.error('Error fetching the schedule data:', error);
                fetchedScheduleData = []; // 載入失敗則清空數據
                filterAndRenderTable(); // 即使失敗，也用預設數據渲染表格
            });

        // 當 HTML 內容完全載入後執行
        document.addEventListener('DOMContentLoaded', () => {
            populateGroupDropdown(); // 先填充下拉選單
            // 綁定下拉選單的變更事件
            document.getElementById('groupSelector').addEventListener('change', filterAndRenderTable);
            // 第一次載入數據並渲染表格已在 fetch 的 then/catch 區塊中處理
        });
    </script>
</body>
</html>